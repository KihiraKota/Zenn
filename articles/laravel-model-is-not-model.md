---
title: "「LaravelのModel」＝「モデル」ではない、という話"
emoji: "🦝"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [laravel, ドメイン駆動設計, mvc]
published: false
---
「LaravelのModel」は、LaravelというWebアプリケーションフレームワークの世界の中ではもちろん「モデル」なのですが、Laravelの世界の外では「モデル」とはならないことが多々あります。Laravelでの開発しか経験していないと、ついつい「LaravelのModel」＝「モデル」と捉えてしまいがちですが、具体的に何を「モデル」とするのかは、設計やアーキテクチャー、フレームワークなどによって変わるものです。

## ドメイン駆動設計で見る「LaravelのModel」

では「LaravelのModel」はLaravelの世界の外では何になるのか、という具体例として、ドメイン駆動設計の観点で見た場合の「LaravelのModel」について話をします。

まず、話を単純化するため、以下の２つのことができるだけの極めてシンプルなアプリケーションを作成するものとします。

- 記事を作成する
- 指定されたIDの記事を返す

「記事(=Article)」というのも、「題名(=title)」と「本文(=body)」というプロパティを持つ極めてシンプルなオブジェクトとしてください。

### 第１段階

上記のアプリケーションをLaravelで作成する場合、まずは `\App\Models\Article` という「LaravelのModel」を作り、その上で以下のような流れの処理を作るはずです。

- 記事を作成する
    1. ユーザーが作成したい「記事」の「題名」と「本文」を入力し、入力した内容を送信する
    1. コントローラーがユーザーが送信した内容を受け取る
    1. 受け取った内容で `\App\Models\Article` のインスタンスを作成し、保存する
    1. 保存した `\App\Models\Article` のインスタンスを使って生成したHTMLやJSONのデータをユーザーに返す
- 指定されたIDの記事を返す
    1. ユーザーが取得したい「記事」のIDを入力し、入力したIDを送信する
    1. コントローラーがユーザーが送信したIDを受け取る
    1. 受け取ったIDに対応する `\App\Models\Article` のインスタンスを取得する
    1. 取得した `\App\Models\Article` のインスタンスを使って生成したHTMLやJSONのデータをユーザーに返す

### 第２段階

Laravelのアプリケーションのコードとしてはここまでを書けば十分だと思いますが、 3. の `\App\Models\Article` のインスタンスの保存や取得は、実際はデータベースに対して行われます。そしてこのデータベースに対して行われる操作は「Laravelのモデル」が内部的に行っているわけですが、このときの処理を分解すると、以下のようになります。

- 記事を作成する
    1. ユーザーが作成したい「記事」の「題名」と「本文」を入力し、入力した内容を送信する
    1. コントローラーがユーザーが送信した内容を受け取る
    1. __受け取った内容で `\App\Models\Article` のインスタンスを作成する__
    1. __`\App\Models\Article` のインスタンスから、データベースにレコードを追加するSQL文を生成する__
    1. __生成したSQL文を実行し、データベースにレコードを追加する__
    1. 保存した `\App\Models\Article` のインスタンスを使って生成したHTMLやJSONのデータをユーザーに返す
- 指定されたIDの記事を返す
    1. ユーザーが取得したい「記事」のIDを入力し、入力したIDを送信する
    1. コントローラーがユーザーが送信したIDを受け取る
    1. __受け取ったIDに対応するレコードをデータベースから取得するSQL文を生成する__
    1. __生成したSQL文を実行し、データベースからレコードを取得する__
    1. __取得したレコードの内容で `\App\Models\Article` のインスタンスを作成する__
    1. 取得した `\App\Models\Article` のインスタンスを使って生成したHTMLやJSONのデータをユーザーに返す

### 第３段階

ドメイン駆動設計では、「記事」のようなオブジェクトのことを __「エンティティ」__ と呼び、この「エンティティ」の保存や、保存した「エンティティ」の取得をするものとして、 __「リポジトリ」__ というオブジェクトが登場します。

これらの用語を使って上記の処理を言い換えると、以下のようになります。

- 記事を作成する
    1. ユーザーが作成したい「記事」の「題名」と「本文」を入力し、入力した内容を送信する
    1. コントローラーがユーザーが送信した内容を受け取る
    1. __受け取った内容で「記事エンティティ」のインスタンスを作成する__
    1. __作成した「記事エンティティ」のインスタンスを「記事リポジトリ」に渡し、保存させる__
        1. __受け取った「記事エンティティ」から、データベースにレコードを追加するSQL文を生成する__
        1. __生成したSQL文を実行し、データベースにレコードを追加する__
    1. 保存した「記事エンティティ」のインスタンスを使って生成したHTMLやJSONのデータをユーザーに返す
- 指定されたIDの記事を返す
    1. ユーザーが取得したい「記事」のIDを入力し、入力したIDを送信する
    1. コントローラーがユーザーが送信したIDを受け取る
    1. __受け取ったIDを「記事リポジトリ」に渡し、対応する「記事エンティティ」を取得させる__
        1. __受け取ったIDに対応するレコードをデータベースから取得するSQL文を生成する__
        1. __生成したSQL文を実行し、データベースからレコードを取得する__
        1. __取得したレコードの内容で「記事エンティティ」のインスタンスを作成する__
    1. 取得した「記事エンティティ」のインスタンスを使って生成したHTMLやJSONのデータをユーザーに返す

`\App\Models\Article` という「LaravelのModel」がすべて「エンティティ」と「リポジトリ」に置き換わっていますが、処理の内容は本質的には何も変わっていません。このことから「LaravelのModel」は、ドメイン駆動設計の「エンティティ」と「リポジトリ」の性質や役割を１つにまとめたものだ、ということができます。

## 「MVCのModel」と「LaravelのModel」

---

ドメインモデル
ドメイン駆動設計だと、ドメインのプロセスやルールをモデリングしたもの
オニオンアーキテクチャーだと、ドメイン内の要素として登場するオブジェクトのこと

リポジトリ
ドメイン駆動設計だと、エンティティを保存するもの
オニオンアーキテクチャーだと、ドメインサービスの一種

データモデル
ドメイン駆動設計のエンティティ、オニオンアーキテクチャーのドメインモデルをどうやってデータとして保存するかを表したもの
